policies:
  - uid: mondoo-operator
    name: Mondoo Operator Policy
    version: "1.0.0"
    authors:
      - name: Mondoo, Inc
        email: hello@mondoo.io
    specs:
      - title: General
        asset_filter:
          query: platform.name == "kubernetes"
        scoring_queries:
          # namespace-exists: # deactivated since there is a bug with namespaces
          crd-created:
          controller-deployed:
      - title: Node Scan
        asset_filter:
          query: platform.name == "kubernetes"
        scoring_queries:
          daemonset-exists:
      - title: Resource Scan
        asset_filter:
          query: platform.name == "kubernetes"
        scoring_queries:
          deployment-exists:
queries:
  - uid: namespace-exists
    title: Ensure the namespace exists
    query: k8s.namespaces.one ( name == "mondoo-operator-system")
  - uid: crd-created
    title: Ensure the CRD for MondooScanConfig exitsts
    query: k8s.apiResources.one( kind == "MondooAuditConfig")
  - uid: controller-deployed
    title: Ensure the Controller is deployed
    query: k8s.deployments.one( name == "mondoo-operator-controller-manager" && namespace == "mondoo-operator-system" )
  - uid: deployment-exists
    title: Ensure the deployment is configured
    query: k8s.deployments.one( name == "mondoo-client" && namespace == "mondoo-operator-system" )
  - uid: daemonset-exists
    title: Ensure the daemonset is configured
    query: k8s.daemonsets.one( name == "mondoo-client" && namespace == "mondoo-operator-system" )
